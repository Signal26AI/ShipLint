---
import BaseLayout from './BaseLayout.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';

interface Props {
  title: string;
  description: string;
  pubDate: Date;
  updatedDate?: Date;
  tags?: string[];
  author?: string;
  readingTime?: string;
  canonical?: string;
  heroImage?: string;
}

const { title, description, pubDate, updatedDate, tags = [], author = 'ShipLint Team', readingTime, canonical, heroImage } = Astro.props;
const formattedDate = pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
const formattedUpdated = updatedDate?.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
---

<BaseLayout title={`${title} — ShipLint Blog`} description={description} canonical={canonical} ogType="article" ogImage={heroImage}>
  <Fragment slot="head">
    <meta property="article:published_time" content={pubDate.toISOString()}>
    {updatedDate && <meta property="article:modified_time" content={updatedDate.toISOString()}>}
    {tags.map(tag => <meta property="article:tag" content={tag}>)}
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "headline": title,
      "description": description,
      "datePublished": pubDate.toISOString(),
      "dateModified": (updatedDate || pubDate).toISOString(),
      "author": { "@type": "Organization", "name": author, "url": "https://shiplint.app" },
      "publisher": { "@type": "Organization", "name": "ShipLint", "url": "https://shiplint.app" },
      "mainEntityOfPage": { "@type": "WebPage", "@id": canonical || `https://shiplint.app/blog/` },
      "keywords": tags.join(', ')
    })} />
  </Fragment>

  <Nav showSections={false} />

  <main id="main" class="pt-16">
    <article class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <!-- Breadcrumb -->
      <nav aria-label="Breadcrumb" class="mb-8 text-sm text-muted">
        <a href="/" class="hover:text-accent transition-colors">ShipLint</a>
        <span class="mx-2">›</span>
        <a href="/blog/" class="hover:text-accent transition-colors">Blog</a>
        <span class="mx-2">›</span>
        <span class="text-white truncate">{title}</span>
      </nav>

      <header class="mb-10">
        {tags.length > 0 && (
          <div class="flex flex-wrap gap-2 mb-4">
            {tags.map(tag => (
              <a href={`/blog/tag/${tag.toLowerCase().replace(/\s+/g, '-')}/`} class="text-xs font-medium bg-accent/10 text-accent px-2.5 py-1 rounded-full hover:bg-accent/20 transition-colors">
                {tag}
              </a>
            ))}
          </div>
        )}
        <h1 class="text-3xl sm:text-4xl font-extrabold text-white leading-tight mb-4">{title}</h1>
        <div class="flex items-center gap-4 text-sm text-muted">
          <time datetime={pubDate.toISOString()}>{formattedDate}</time>
          {readingTime && <span>· {readingTime}</span>}
          {author && <span>· {author}</span>}
        </div>
        {formattedUpdated && (
          <p class="text-xs text-surface-500 mt-2">Updated {formattedUpdated}</p>
        )}
      </header>

      {heroImage && (
        <img src={heroImage} alt="" class="w-full rounded-xl mb-10 border border-surface-600">
      )}

      <div class="prose max-w-none">
        <slot />
      </div>

      <!-- CTA -->
      <div class="mt-16 bg-surface-800 border border-accent/20 rounded-xl p-8 text-center">
        <h2 class="text-xl font-bold text-white mb-3">Catch App Store issues before submission</h2>
        <p class="text-muted mb-6">ShipLint scans your Xcode project for rejection risks. One command. Free.</p>
        <div class="bg-surface-900 border border-surface-600 rounded-lg px-6 py-3 inline-block font-mono text-sm mb-4">
          <span class="text-muted">$</span> <span class="text-accent-light">npx shiplint scan .</span>
        </div>
        <div>
          <a href="/" class="text-accent hover:text-accent-light underline underline-offset-2 text-sm">Learn more about ShipLint →</a>
        </div>
      </div>
    </article>
  </main>

  <Footer />
</BaseLayout>
